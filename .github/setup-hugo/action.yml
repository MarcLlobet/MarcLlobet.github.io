name: Setup Hugo
runs:
  steps:
    - name: Install Hugo
      uses: peaceiris/actions-hugo@v2
      with:
        hugo-version: 'latest'
        extended: true
    - name: Install Dart Sass Embedded
      run: sudo snap install dart-sass-embedded
    - name: Checkout
      uses: actions/checkout@v3
      with:
        submodules: recursive
    - name: Install Node.js dependencies
      run: "[[ -f package-lock.json || -f npm-shrinkwrap.json ]] && npm ci || true"
    - name: Build with Hugo
      env:
        # For maximum backward compatibility with Hugo modules
        HUGO_ENVIRONMENT: production
        HUGO_ENV: production
      run: |
        hugo \
          --minify \
          --baseURL "${{ steps.pages.outputs.base_url }}/"
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v1
      with:
        path: ./public